(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{NTnD:function(e,a,t){"use strict";var n=t("KECP"),o=t("u7nK"),i=t("IdPd"),r=t("b8bG"),l=t("6233"),s=function(){},c=t("CcnG"),u=function(){function e(e){this.firebase=e,this.selectedRoute=new s}return e.prototype.getData=function(){return this.routeList=this.firebase.list("route2017"),this.routeList},e.ngInjectableDef=c.defineInjectable({factory:function(){return new e(c.inject(l.a))},token:e,providedIn:"root"}),e}(),d=t("t/Na");t.d(a,"a",function(){return h});var h=function(){function e(e,a,t,n,o,i){this.http=e,this.rastraService=a,this.gudangService=t,this.dataranTinggiService=n,this.route2016Service=o,this.route2017Service=i,this.sum_colli=0,this.jarak2016=0,this.jarak2017=0,this.vCap=533,this.vDating=400}return e.prototype.GA=function(e,a,t,n){var o=this;return new Promise(function(i,r){o.distance=[],o.rastra=[],o.gudang=[],o.dataran=[],o.route=[],o.f_gudang=[],o.sum_colli=0,o.sub_colli=[],o.InitializeDistance().then(function(e){if(e)return o.InitializeRastra()}).then(function(e){if(e)return o.InitializeGudang()}).then(function(e){if(e)return o.InitializeDataran()}).then(function(a){if(a)return o.generateRoute(e)}).then(function(e){if(e)return console.log(o.sub_colli),o.generateDepot(o.route.length,o.deepCopy(o.sub_colli))}).then(function(r){if(r){o.f_gudang=o.deepCopy(r);var l=o.evaluasiPopulasi(o.deepCopy(o.route),o.deepCopy(r));if(o.route.length==e){var s=o.minVal(o.deepCopy(l)),c=s[0],u=[],d=o.deepCopy(o.route[s[1]]),h=o.deepCopy(r[s[1]]),p=0;for(o.numIter=a;p<o.numIter;){console.log("iter : "+p);var f=o.calculateFitness(o.deepCopy(l)),g=o.selection(o.deepCopy(o.route),o.deepCopy(f),o.deepCopy(r));o.prob_cross=t;var k=o.crossover(o.deepCopy(g[0]),o.deepCopy(o.route),o.deepCopy(g[1]),o.deepCopy(g[2]));o.prob_mutation=n;var v=o.mutation(o.deepCopy(k[0]));l=o.evaluasiPopulasi(o.deepCopy(v),o.deepCopy(k[1]));var m=o.minVal(o.deepCopy(l));u[p]=c,c>m[0]&&(c=m[0],d=o.deepCopy(v)[s[1]],h=o.deepCopy(k[1])[s[1]]),console.log(c),p++}return console.log(u),console.log(d),console.log(h),i([u,d,h])}return console.log("caonnot process : gudang stok tidkan mencukupi"),i(!1)}})})},e.prototype.getJSON=function(){return this.http.get("./assets/data.json")},e.prototype.InitializeDistance=function(){var e=this;return new Promise(function(a,t){var n=0;e.distance=[],e.getJSON().subscribe(function(t){return t.Distance.forEach(function(a){e.distance[n]=[],e.distance[n]=a,n++}),a(!0)})})},e.prototype.InitializeRastra=function(){var e=this;return new Promise(function(a,t){e.rastra=[],e.rastraService.getData().snapshotChanges().subscribe(function(t){var n=0;return t.forEach(function(a){var t=a.payload.toJSON();e.sum_colli+=t.colli,t.$key=n,e.rastra.push(t),n++}),a(!0)})})},e.prototype.InitializeGudang=function(){var e=this;return new Promise(function(a,t){e.gudang=[],e.gudangService.getData().snapshotChanges().subscribe(function(t){return t.forEach(function(a){var t=a.payload.toJSON();e.gudang.push(t)}),a(!0)})})},e.prototype.InitializeDataran=function(){var e=this;return new Promise(function(a,t){e.dataranTinggiService.getData().snapshotChanges().subscribe(function(t){return e.dataran=[],t.forEach(function(a){var t=a.payload.toJSON();e.dataran.push(t)}),a(!0)})})},e.prototype.isDataranTinggi=function(e,a){for(var t=!1,n=0;n<this.dataran.length;n++)e==this.dataran[n].desa&&a==this.dataran[n].kecamatan&&(t=!0);return t},e.prototype.isEnoughStok=function(e,a){for(var t=!0,n=[],o=[],i=0;i<e.length;i++){var r=n.indexOf(e[i]);-1==r?o[n.push(e[i])-1]=1:o[r]+=1}for(i=0;i<n.length;i++){for(var l=0;l<a.length&&o[i]>0;){var s=Math.floor(1e3*a[l].stok/15/n[i]);s<=o[i]?(a[l].stok-=s*n[i]*15/1e3,o[i]-=s):(a[l].stok-=o[i]*n[i]*15/1e3,o[i]-=o[i]),l++}o[i]>0&&(t=!1)}return t},e.prototype.generateRoute=function(e){var a=this;return new Promise(function(t,n){var o=e,i=0;a.route=[],a.sub_colli=[];for(var r=0,l=!1;i<o&&!l;){a.route[i]=[];var s=0,c=a.sum_colli,u=a.deepCopy(a.gudang),d=a.deepCopy(a.rastra);for(a.sub_colli[i]=[];c>0;){a.route[i][s]=[];for(var h=a.vCap,p=0,f=!1,g=a.vDating,k=0;h>0&&g>0&&c>0;){a.route[i][s][p]=[];var v=Math.floor(Math.random()*d.length);0==p?f=a.isDataranTinggi(d[v].desa,d[v].kecamatan):f||(f=a.isDataranTinggi(d[v].desa,d[v].kecamatan)),f?h>=g?g>=d[v].colli?(a.route[i][s][p].index=d[v].$key,a.route[i][s][p].desa=d[v].desa,a.route[i][s][p].kecamatan=d[v].kecamatan,a.route[i][s][p].kab=d[v].kabupaten,a.route[i][s][p].load=d[v].colli,h-=d[v].colli,g-=d[v].colli,k+=d[v].colli,c-=d[v].colli,d.splice(v,1)):(a.route[i][s][p].index=d[v].$key,a.route[i][s][p].desa=d[v].desa,a.route[i][s][p].kecamatan=d[v].kecamatan,a.route[i][s][p].kab=d[v].kabupaten,a.route[i][s][p].load=g,d[v].colli=d[v].colli-g,h-=g,k+=g,c-=g,g-=g):h>=d[v].colli?(a.route[i][s][p].index=d[v].$key,a.route[i][s][p].desa=d[v].desa,a.route[i][s][p].kecamatan=d[v].kecamatan,a.route[i][s][p].kab=d[v].kabupaten,a.route[i][s][p].load=d[v].colli,h-=d[v].colli,g-=d[v].colli,k+=d[v].colli,c-=d[v].colli,d.splice(v,1)):(a.route[i][s][p].index=d[v].$key,a.route[i][s][p].desa=d[v].desa,a.route[i][s][p].kecamatan=d[v].kecamatan,a.route[i][s][p].kab=d[v].kabupaten,a.route[i][s][p].load=h,d[v].colli=d[v].colli-h,g-=h,k+=h,c-=h,h-=h):h>=d[v].colli?(a.route[i][s][p].index=d[v].$key,a.route[i][s][p].desa=d[v].desa,a.route[i][s][p].kecamatan=d[v].kecamatan,a.route[i][s][p].kab=d[v].kabupaten,a.route[i][s][p].load=d[v].colli,h-=d[v].colli,k+=d[v].colli,c-=d[v].colli,d.splice(v,1)):(a.route[i][s][p].index=d[v].$key,a.route[i][s][p].desa=d[v].desa,a.route[i][s][p].kecamatan=d[v].kecamatan,a.route[i][s][p].kab=d[v].kabupaten,a.route[i][s][p].load=h,d[v].colli=d[v].colli-h,k+=h,c-=h,h-=h),p++}a.sub_colli[i][s]=k,s++}a.isEnoughStok(a.sub_colli[i],u)?(i++,r=0):(10==r&&(l=!0),r++)}return t(!0)})},e.prototype.generateDepot=function(e,a){var t=this;return new Promise(function(n,o){for(var i=0,r=[];i<e;){var l=t.deepCopy(t.gudang),s=0;r[i]=[];for(var c=!1,u=0;s<t.route[i].length&&!c&&0!=l.length;){var d=Math.floor(Math.random()*l.length),h=Math.floor(1e3*l[d].stok/15);if(a[i][s]<=h)r[i][s]=d,l[d].stok-=15*a[i][s]/1e3,0==l[d].stok&&l.splice(d,1),u=0,s++;else if(10==u){for(var p=0,f=!1;p<l.length&&!f;)h=Math.floor(1e3*l[p].stok/15),a[i][s]<=h&&(r[i][s]=p,l[p].stok-=15*a[i][s]/1e3,0==l[p].stok&&l.splice(p,1),u=0,s++,f=!0),p++;if(0==f){c=!0;break}}else u++}if(1==c){r.pop();break}i++}return n(r)})},e.prototype.evaluasiPopulasi=function(e,a){for(var t=[],n=0,o=0;n<e.length;){for(var i=0,r=0;i<e[n].length;){var l=0,s=0;for(s+=Number(this.distance[a[n][i]][e[n][i][l].index+7]),s+=Number(this.distance[e[n][i][e[n][i].length-1].index+7][a[n][i]]);l<e[n][i].length-1;)s+=Number(this.distance[e[n][i][l].index+7][e[n][i][l+1].index+7]),l++;r+=s,i++}o+=r,t[n]=r,n++}return t[e.length]=o,t},e.prototype.calculateFitness=function(e){for(var a=0,t=[];a<e.length-1;)t[a]=e[e.length-1]/e[a],a++;return t},e.prototype.selection=function(e,a,t){for(var n=[],o=[],i=[],r=[],l=0,s=0;l<a.length;)i[l]=s+=a[l],l++;for(var c=0;c<i.length;)r[c]=i[c]/i[i.length-1],c++;for(var u=[],d=0;d<r.length;){for(var h=Math.random(),p=0;p<r.length&&h>r[p];)p++;u[d]=p,n.push(e[p]),o.push(t[p]),d++}return[n,u,o]},e.prototype.crossover=function(e,a,t,n){for(var o=[],i=[],r=0;r<e.length;){var l=[],s=[];if(Math.random()<this.prob_cross){var c=Math.floor(Math.random()*e.length),u=!0;for(t[r]!=c&&(u=!1);u;)c=Math.floor(Math.random()*e.length),t[r]!=c&&(u=!1);for(var d=this.deepCopy(this.gudang),h=this.deepCopy(this.rastra),p=Math.floor(a[c].length/3),f=0,g=p+1,k=[],v=this.sum_colli,m=[],b=!1;f<e[r].length;){var y=0;if(f<=p){l[f]=a[r][f],s[f]=n[r][f];for(var x=0;x<a[r][f].length;x++)k.includes(a[r][f][x].index)||k.push(a[r][f][x].index),h[a[r][f][x].index].colli-=a[r][f][x].load,v-=a[r][f][x].load,y+=a[r][f][x].load;m[f]=y}else{for(var C=0,M=!1;C<e[r][f].length&&!M;)k.includes(e[r][f][C].index)&&(M=!0),C++;if(!M){for(l[g]=e[r][f],s[g]=n[r][f],f==e[r].length-1&&(b=!0),x=0;x<e[r][f].length;x++)k.push(e[r][f][x].index),h[e[r][f][x].index].colli-=e[r][f][x].load,v-=e[r][f][x].load,y+=e[r][f][x].load;m[g]=y,g++}}f++}for(var I=[],D=0;D<h.length;D++)0!=h[D].colli&&I.push(D);if(b){for(var _=0,$=!1,j=0,S=0;S<l[l.length-1].length;S++)_+=l[l.length-1][S].load,this.isDataranTinggi(l[l.length-1][S].desa,l[l.length-1][S].kecamatan)&&($=!0),$&&(j+=l[l.length-1][S].load);var w=this.vDating,N=l[l.length-1].length;if(_<(R=this.vCap))if(R-=_,w-=j,y=_,1==$&&j<w){for(;R>0&&w>0&&I.length>0;){var O=Math.floor(Math.random()*I.length),P=[];l[l.length-1][N]=[],R>=w?w>=h[I[O]].colli?(P.index=h[I[O]].$key,P.desa=h[I[O]].desa,P.kecamatan=h[I[O]].kecamatan,P.kab=h[I[O]].kabupaten,P.load=h[I[O]].colli,l[l.length-1][N]=P,R-=h[I[O]].colli,y+=w-=h[I[O]].colli,v-=h[I[O]].colli,h[I[O]].colli-=h[I[O]].colli,I.splice(I.indexOf(I[O]),1)):(P.index=h[I[O]].$key,P.desa=h[I[O]].desa,P.kecamatan=h[I[O]].kecamatan,P.kab=h[I[O]].kabupaten,P.load=w,l[l.length-1][N]=P,R-=w,y+=w,v-=w,h[I[O]].colli-=w,w-=w):R>=h[I[O]].colli?(P.index=h[I[O]].$key,P.desa=h[I[O]].desa,P.kecamatan=h[I[O]].kecamatan,P.kab=h[I[O]].kabupaten,P.load=h[I[O]].colli,l[l.length-1][N]=P,R-=h[I[O]].colli,w-=h[I[O]].colli,y+=h[I[O]].colli,v-=h[I[O]].colli,h[I[O]].colli-=h[I[O]].colli,I.splice(I.indexOf(I[O]),1)):(P.index=h[I[O]].$key,P.desa=h[I[O]].desa,P.kecamatan=h[I[O]].kecamatan,P.kab=h[I[O]].kabupaten,P.load=R,l[l.length-1][N]=P,w-=R,y+=R,v-=R,h[I[O]].colli-=R,R-=R),N++}m[l.length-1]=y}else{for(;R>0&&w>0&&I.length>0;)P=[],l[l.length-1][N]=[],R>=h[I[O=Math.floor(Math.random()*I.length)]].colli?(P.index=h[I[O]].$key,P.desa=h[I[O]].desa,P.kecamatan=h[I[O]].kecamatan,P.kab=h[I[O]].kabupaten,P.load=h[I[O]].colli,l[l.length-1][N]=P,R-=h[I[O]].colli,y+=h[I[O]].colli,v-=h[I[O]].colli,h[I[O]].colli-=h[I[O]].colli,I.splice(I.indexOf(I[O]),1)):(P.index=h[I[O]].$key,P.desa=h[I[O]].desa,P.kecamatan=h[I[O]].kecamatan,P.kab=h[I[O]].kabupaten,P.load=R,l[l.length-1][N]=P,y+=R,v-=R,h[I[O]].colli-=R,R-=R),N++;m[l.length-1]=y}}for(var z=l.length;v>0;){var R=this.vCap,E=0;for($=!1,w=this.vDating,y=0,l[z]=[];R>0&&w>0&&v>0;)l[z][E]=[],O=Math.floor(Math.random()*I.length),0==E?$=this.isDataranTinggi(h[I[O]].desa,h[I[O]].kecamatan):$||($=this.isDataranTinggi(h[I[O]].desa,h[I[O]].kecamatan)),$?R>=w?w>=h[I[O]].colli?(l[z][E].index=h[I[O]].$key,l[z][E].desa=h[I[O]].desa,l[z][E].kecamatan=h[I[O]].kecamatan,l[z][E].kab=h[I[O]].kabupaten,l[z][E].load=h[I[O]].colli,R-=h[I[O]].colli,w-=h[I[O]].colli,y+=h[I[O]].colli,v-=h[I[O]].colli,h[I[O]].colli-=h[I[O]].colli,I.splice(I.indexOf(I[O]),1)):(l[z][E].index=h[I[O]].$key,l[z][E].desa=h[I[O]].desa,l[z][E].kecamatan=h[I[O]].kecamatan,l[z][E].kab=h[I[O]].kabupaten,l[z][E].load=w,h[I[O]].colli-=w,R-=w,y+=w,v-=w,w-=w):R>=h[I[O]].colli?(l[z][E].index=h[I[O]].$key,l[z][E].desa=h[I[O]].desa,l[z][E].kecamatan=h[I[O]].kecamatan,l[z][E].kab=h[I[O]].kabupaten,l[z][E].load=h[I[O]].colli,R-=h[I[O]].colli,w-=h[I[O]].colli,y+=h[I[O]].colli,v-=h[I[O]].colli,h[I[O]].colli-=h[I[O]].colli,I.splice(I.indexOf(I[O]),1)):(l[z][E].index=h[I[O]].$key,l[z][E].desa=h[I[O]].desa,l[z][E].kecamatan=h[I[O]].kecamatan,l[z][E].kab=h[I[O]].kabupaten,l[z][E].load=R,h[I[O]].colli-=R,w-=R,y+=R,v-=R,R-=R):R>=h[I[O]].colli?(l[z][E].index=h[I[O]].$key,l[z][E].desa=h[I[O]].desa,l[z][E].kecamatan=h[I[O]].kecamatan,l[z][E].kab=h[I[O]].kabupaten,l[z][E].load=h[I[O]].colli,R-=h[I[O]].colli,y+=h[I[O]].colli,v-=h[I[O]].colli,h[I[O]].colli-=h[I[O]].colli,I.splice(I.indexOf(I[O]),1)):(l[z][E].index=h[I[O]].$key,l[z][E].desa=h[I[O]].desa,l[z][E].kecamatan=h[I[O]].kecamatan,l[z][E].kab=h[I[O]].kabupaten,l[z][E].load=R,h[I[O]].colli-=R,y+=R,v-=R,R-=R),E++;m[z]=y,z++}for(var J=0,T=s.length,G=!1,A=0;J<l.length&&!G&&0!=d.length;)if(J<T){var V=Math.floor(1e3*d[s[J]].stok/15);if(m[J]<=V)d[s[J]].stok-=15*m[J]/1e3,0==d[s[J]].stok&&d.splice(s[J],1),J++;else{var F=Math.floor(Math.random()*d.length),K=Math.floor(1e3*d[F].stok/15);if(m[J]<=K)s[J]=F,d[F].stok-=15*m[J]/1e3,0==d[F].stok&&d.splice(F,1),A=0,J++;else if(10==A){for(var L=0,q=!1;L<d.length&&!q;)K=Math.floor(1e3*d[L].stok/15),m[J]<=K&&(s[J]=L,d[L].stok-=15*m[J]/1e3,0==d[L].stok&&d.splice(L,1),A=0,J++,q=!0),L++;if(0==q){G=!0;break}}else A++}}else if(F=Math.floor(Math.random()*d.length),V=Math.floor(1e3*d[F].stok/15),m[J]<=V)s[J]=F,d[F].stok-=15*m[J]/1e3,0==d[F].stok&&d.splice(F,1),A=0,J++;else if(10==A){for(L=0,q=!1;L<d.length&&!q;)V=Math.floor(1e3*d[L].stok/15),m[J]<=V&&(s[J]=L,d[L].stok-=15*m[J]/1e3,0==d[L].stok&&d.splice(L,1),A=0,J++,q=!0),L++;if(0==q){G=!0;break}}else A++;o[r]=l,i[r]=s,1==G&&(console.log("unfeasible"),o[r]=e[r],i[r]=n[r])}else o[r]=e[r],i[r]=n[r];r++}return[o,i]},e.prototype.deepCopy=function(e){var a=this;return"object"==typeof e?Object.keys(e).map(function(t){return(n={})[t]=a.deepCopy(e[t]),n;var n}).reduce(function(e,a){return Object.assign(e,a)},[]):Array.isArray(e)?e.map(this.deepCopy):e},e.prototype.mutation=function(e){for(var a=0;a<e.length;){for(var t=0;t<e[a].length;){if(Math.random()<this.prob_mutation&&e[a][t].length>2){for(var n=[],o=0;o<e[a][t].length;o++)n.push(o);var i=Math.floor(Math.random()*n.length);n.splice(i=n[i],1);var r=Math.floor(Math.random()*n.length),l=e[a][t][i];e[a][t][i]=e[a][t][r=n[r]],e[a][t][r]=l}t++}a++}return e},e.prototype.minVal=function(e){for(var a=e[0],t=0,n=0;n<e.length-1;n++)e[n]<a&&(a=e[n],t=n);return[a,t]},e.prototype.getRoute2016=function(){var e=this;this.InitializeRastra().then(function(a){if(a)return e.InitializeDistance()}).then(function(a){if(a){var t,n=e.route2016Service.getData();console.log(n),n.snapshotChanges().subscribe(function(a){t=[],a.forEach(function(e){var a=e.payload.toJSON();t.push(a)});var n=[],o=[],i=0,r=1;for(n[0]=[],t[i].index=e.getIndex(t[i].kecamatan,t[i].desa),n[r-1].push(t[i]),o.push(t[i].fgudang);i<t.length-1;)t[i+1].subRoute==r?(t[i+1].index=e.getIndex(t[i+1].kecamatan,t[i+1].desa),n[r-1].push(t[i+1])):(t[i].index=e.getIndex(t[i].kecamatan,t[i].desa),o.push(t[i].fgudang),n[r]=[],t[i+1].index=e.getIndex(t[i+1].kecamatan,t[i+1].desa),n[r].push(t[i+1]),r++),i++;var l=e.evaluasiPopulasi_route(n,o);console.log(l),e.jarak2016=l})}})},e.prototype.getRoute2017=function(){var e=this;this.InitializeRastra().then(function(a){if(a)return e.InitializeDistance()}).then(function(a){if(a){var t,n=e.route2017Service.getData();console.log(n),n.snapshotChanges().subscribe(function(a){t=[],a.forEach(function(e){var a=e.payload.toJSON();t.push(a)});var n=[],o=[],i=0,r=1;for(n[0]=[],t[i].index=e.getIndex(t[i].kecamatan,t[i].desa),n[r-1].push(t[i]),o.push(t[i].fgudang);i<t.length-1;)t[i+1].subRoute==r?(t[i+1].index=e.getIndex(t[i+1].kecamatan,t[i+1].desa),n[r-1].push(t[i+1])):(t[i].index=e.getIndex(t[i].kecamatan,t[i].desa),o.push(t[i].fgudang),n[r]=[],t[i+1].index=e.getIndex(t[i+1].kecamatan,t[i+1].desa),n[r].push(t[i+1]),r++),i++;var l=e.evaluasiPopulasi_route(n,o);console.log(l),e.jarak2017=l})}})},e.prototype.evaluasiPopulasi_route=function(e,a){for(var t=0,n=0;t<e.length;){var o=0,i=0;for(i+=Number(this.distance[a[t]][e[t][o].index+7]),i+=Number(this.distance[e[t][e[t].length-1].index+7][a[t]]);o<e[t].length-1;)i+=Number(this.distance[e[t][o].index+7][e[t][o+1].index+7]),o++;n+=i,t++}return n},e.prototype.getIndex=function(e,a){for(var t=!1,n=0,o=-1;!t&&n<this.rastra.length;)this.rastra[n].kecamatan==e&&this.rastra[n].desa==a&&(t=!0,o=Number(this.rastra[n].$key)),n++;return t||console.log("not found"+o),o},e.ngInjectableDef=c.defineInjectable({factory:function(){return new e(c.inject(d.c),c.inject(n.a),c.inject(o.a),c.inject(i.a),c.inject(r.a),c.inject(u))},token:e,providedIn:"root"}),e}()}}]);